<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù…ÙÙ‡ÙÙ† | Ø§Ù„Ø³Ù„Ø©</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#e9e6e2; --card:#fff; --text:#2d2d2d; --muted:#555; --chip:#E6D5B8;
  --accent:#5A8DA8; --accent-hover:#4F7E97;
  --danger:#C62828; --danger-hover:#A61717;
  --border:#8B4513; --radius:20px;
  --shadow:0 4px 12px rgba(0,0,0,.08); --shadow-lg:0 8px 20px rgba(0,0,0,.15);
}
*{box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;background:var(--bg);margin:0;color:var(--text);display:flex;flex-direction:column;min-height:100vh}

/* Header */
.site-header{
  background:#d8d5d0;border-bottom:2px solid #b9b6b2;padding:15px 20px;text-align:center;position:relative;box-shadow:0 2px 6px rgba(0,0,0,.05)
}
.logo{width:120px}
.logout-btn{position:absolute;right:20px;top:50%;transform:translateY(-50%)}
.logout-btn img{width:55px;height:55px;cursor:pointer;transition:.3s}
.logout-btn img:hover{transform:scale(1.1)}
.back-link{
  position:absolute;left:25px;top:25px;font-size:28px;color:#5A8DA8;text-decoration:none;font-weight:800;transition:.2s
}
.back-link:hover{color:#4F7E97;transform:translateX(-3px)}

main{padding:24px;flex:1}
.page-title{display:flex;align-items:center;gap:10px;margin:0 0 18px;font-size:1.25rem;font-weight:800}

.cart-wrap{display:grid;grid-template-columns:1fr 360px;gap:22px}
@media (max-width:980px){.cart-wrap{grid-template-columns:1fr}}

.item-card{
  background:var(--card);border:2px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin-bottom:16px;transition:.25s
}
.item-card:hover{box-shadow:var(--shadow-lg);background:#F5F5DC}
.item-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.item-header h3{margin:0;font-size:1.1rem}
.item-emoji{font-size:22px}
.item-desc{color:var(--muted);margin:6px 0 10px}
.item-chip{display:flex;justify-content:space-between;align-items:center;gap:10px;background:var(--chip);padding:8px 12px;border-radius:12px;font-weight:700;color:#333}

.item-actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.btn{padding:10px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:700;text-decoration:none;display:inline-block;text-align:center}
.btn-blue{background:var(--accent);color:#fff}
.btn-blue:hover{background:var(--accent-hover)}
.btn-red{background:var(--danger);color:#fff}
.btn-red:hover{background:var(--danger-hover)}
.qty-box{display:flex;align-items:center;gap:8px}
.qty-input{width:70px;padding:8px;border:1px solid #ccc;border-radius:10px;text-align:center;font-weight:700}

.summary{
  background:var(--card);border:2px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;height:fit-content
}
.summary h4{margin:0 0 12px}
.total-row{display:flex;justify-content:space-between;font-weight:800;margin:10px 0 16px}
.pay-methods{display:grid;gap:8px;margin:10px 0 16px}
.pay-methods label{display:flex;align-items:center;gap:8px;cursor:pointer}
.info{background:#fff8e1;border:1px solid #f1df9a;color:#7a5d00;padding:10px;border-radius:10px;margin:10px 0;font-size:.95rem}

.empty{background:#fff;border:2px dashed #b9b6b2;border-radius:16px;padding:26px;text-align:center;color:#666}

.site-footer{background:#d8d5d0;border-top:2px solid #b9b6b2;padding:15px;text-align:center;color:#4b4b4b;font-size:15px;box-shadow:0 -2px 6px rgba(0,0,0,.05)}
.site-footer a{color:#3e3e3e;font-weight:bold;text-decoration:none}
.separator{margin:0 8px;color:#999}
</style>
</head>
<body>

<header class="site-header">
  <a href="services.html" class="back-link">â†</a>
  <img src="image/logo.jpg" alt="Ø´Ø¹Ø§Ø± Ù…ÙÙ‡ÙÙ†" class="logo">
  <a href="index.html" aria-label="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬" class="logout-btn">
    <img src="image/logout.png" alt="Ø®Ø±ÙˆØ¬">
  </a>
</header>

<main>
  <h1 class="page-title">ğŸ§º Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>

  <div class="cart-wrap">
    <!-- Ø§Ù„Ø¹Ù†Ø§ØµØ± -->
    <section id="cartItems"></section>

    <!-- Ø§Ù„Ù…Ù„Ø®Øµ -->
    <aside class="summary">
      <h4>Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h4>
      <div class="total-row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span id="totalPrice">0 Ø±.Ø³</span></div>

      <div class="info">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø«Ù… Ø§Ø¶ØºØ· â€œØ¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹â€.</div>

      <div class="pay-methods" id="payMethods">
        <label><input type="radio" name="pm" value="mada"> Ù…Ø¯Ù‰</label>
        <label><input type="radio" name="pm" value="visa"> ÙÙŠØ²Ø§ / Ù…Ø§Ø³ØªØ±</label>
        <label><input type="radio" name="pm" value="apple"> Apple Pay</label>
        <label><input type="radio" name="pm" value="cod"> Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label>
      </div>

      <button id="checkoutBtn" class="btn btn-blue" style="width:100%">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹</button>
    </aside>
  </div>
</main>

<footer class="site-footer">
  <a href="mailto:contact@mihan.sa" class="footer-email">contact@mihan.sa</a>
  <span class="separator">â€¢</span>
  <span>Â© 2025 Ù…ÙÙ‡ÙÙ† â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span>
</footer>

<script>
// Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ†
const cartKey   = 'cart';
const ordersKey = 'orders';

function getCart(){ try{return JSON.parse(localStorage.getItem(cartKey)||'[]')}catch{return []} }
function setCart(items){ localStorage.setItem(cartKey, JSON.stringify(items)); }

function getOrders(){ try{return JSON.parse(localStorage.getItem(ordersKey)||'[]')}catch{return []} }
function setOrders(list){ localStorage.setItem(ordersKey, JSON.stringify(list)); }

// Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©
const listEl  = document.getElementById('cartItems');
const totalEl = document.getElementById('totalPrice');
const payBox  = document.getElementById('payMethods');
const btnPay  = document.getElementById('checkoutBtn');
function toTimeValue(t){
  if(!t) return '00:00';
  const parts = t.toString().split(':');
  const hh = (parts[0] || '00').padStart(2,'0');
  const mm = (parts[1] || '00').padStart(2,'0');
  return `${hh}:${mm}`;
}

// Ø±Ø³Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰
function renderCart(){
  const cart = getCart();
  listEl.innerHTML = '';

  if(cart.length === 0){
    listEl.innerHTML = `
      <div class="empty">
        Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠÙ‹Ø§. <br> Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø§Øª Ù…Ù† <a href="services.html" class="btn btn-blue" style="margin-top:10px">ØµÙØ­Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>.
      </div>
    `;
    totalEl.textContent = '0 Ø±.Ø³';
    return;
  }

  let total = 0;

  cart.forEach((it, idx)=>{
    total += (Number(it.price)||0) * (Number(it.qty)||1);

    const card = document.createElement('article');
    card.className = 'item-card';
    card.innerHTML = `
      <div class="item-header">
        <div class="item-emoji">${it.emoji || 'ğŸ§°'}</div>
        <h3>${it.title || 'Ø®Ø¯Ù…Ø©'}</h3>
      </div>

      ${it.description ? `<p class="item-desc">${it.description}</p>`: ''}

      <div class="item-chip">
        <span>â±ï¸ ${it.time || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
        <span>ğŸ’° ${it.price} Ø±.Ø³</span>
      </div>

      <div class="item-actions">
        <label style="display:flex;align-items:center;gap:8px">
  <span>Ø§Ù„ÙˆÙ‚Øª:</span>
  <input class="time-input" type="time" value="${toTimeValue(it.time)}" data-idx="${idx}">
</label>

        <button class="btn btn-blue" data-action="save" data-idx="${idx}">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn btn-red"  data-action="del"  data-idx="${idx}">Ø­Ø°Ù</button>
      </div>
    `;
    listEl.appendChild(card);
  });

  totalEl.textContent = `${total} Ø±.Ø³`;
}

// Ø£Ø­Ø¯Ø§Ø« ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù
listEl.addEventListener('click', (e)=>{
  const btn = e.target.closest('button');
  if(!btn) return;

  const idx = Number(btn.getAttribute('data-idx'));
  let cart = getCart();

  if(btn.getAttribute('data-action') === 'del'){
    if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
    cart.splice(idx,1);
    setCart(cart);
    renderCart();
    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
    return;
  }

if(btn.getAttribute('data-action') === 'save'){
  const input = listEl.querySelector(`.time-input[data-idx="${idx}"]`);
  let t = (input && input.value) ? input.value : '00:00';
  cart[idx].time = t;
  setCart(cart);
  renderCart();
  return;
}

});

// Ø§Ù„Ø¯ÙØ¹ â†’ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø«Ù… ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±
btnPay.addEventListener('click', ()=>{
  const cart = getCart();

  // (Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ) ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØ­Ù‚Ù‚ Ø¥Ø¶Ø§ÙÙŠ:
  const total = cart.reduce((s,it)=> s + (Number(it.price)||0) * (Number(it.qty)||1), 0);
  const orders = getOrders();
  orders.push({
    id: Date.now(),
    items: cart,
    total,
    method: (payBox.querySelector('input[name="pm"]:checked')||{}).value || 'â€”',
    createdAt: new Date().toISOString(),
    status: 'Ø¬Ø¯ÙŠØ¯'
  });
  setOrders(orders);

  setCart([]); // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
  window.location.href = 'requests.html';
});

// Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
renderCart();
</script>
</body>
</html>
