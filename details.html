<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>تفاصيل الخدمة | مِهَن</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#e9e6e2;
  --card:#fff;
  --text:#2d2d2d;
  --muted:#555;
  --chip:#E6D5B8;
  --accent:#5A8DA8;
  --accent-hover:#4F7E97;
  --border:#8B4513;
  --radius:20px;
  --shadow:0 4px 12px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
body{
  font-family:"Tajawal",sans-serif;background:var(--bg);margin:0;min-height:100vh;
  display:flex;flex-direction:column;align-items:stretch;color:var(--text);}
.site-header {
    background: #d8d5d0;
    border-bottom: 2px solid #b9b6b2;
    padding: 15px 20px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    position: relative; /* حتى نقدر نثبت زر الخروج */
  }

  .logo {
    width: 120px;
  }


  
/* Main */
main{flex:1;display:flex;justify-content:center;align-items:flex-start;padding:24px}
.card{
  background:var(--card);border:2px solid var(--border);border-radius:var(--radius);
  box-shadow:var(--shadow);max-width:600px;width:100%;padding:24px;text-align:center
}
.card h2{margin:10px 0 12px;font-size:1.8rem}
.desc{color:var(--muted);line-height:1.8;margin:0 0 16px}
.info{
  display:flex;justify-content:space-between;gap:10px;background:var(--chip);
  border-radius:12px;padding:10px 14px;font-weight:800;margin:0 0 14px
}
.row{display:flex;justify-content:space-between;align-items:center;margin:8px 0}
.rating{display:flex;justify-content:center;align-items:center;gap:8px;margin:6px 0 2px}
.stars{font-size:20px;letter-spacing:2px}
.muted{color:var(--muted);font-size:.95rem}
.reviews{list-style:none;margin:14px 0 0;padding:0;text-align:right}
.reviews li{background:#faf8f5;border:1px solid #e8e2da;border-radius:12px;padding:10px 12px;margin-bottom:10px}
.reviews strong{margin-left:6px}
.btn{
  display:inline-block;margin-top:16px;padding:12px 18px;border:none;border-radius:10px;
  background:var(--accent);color:#fff;text-decoration:none;font-weight:800;cursor:pointer
}
.btn:hover{background:var(--accent-hover)}
/* Footer */
.site-footer{background:#d8d5d0;border-top:2px solid #b9b6b2;padding:15px;text-align:center;color:#4b4b4b;font-size:15px;box-shadow:0 -2px 6px rgba(0,0,0,0.05)}
.footer-email{color:#3e3e3e;text-decoration:none;font-weight:bold}
.separator{margin:0 8px;color:#999}
</style>
</head>
<body>
<header class="site-header">
  <!-- شعار الموقع -->
    <img src="image/logo.jpg" alt="شعار مِهَن" class="logo">

  <!-- زر الخروج -->
  <a href="index.html" aria-label="تسجيل الخروج" class="logout-btn">
  </a>
</header>


<main>
  <article id="details" class="card"></article>
</main>

<footer class="site-footer">
  <a href="mailto:contact@mihan.sa" class="footer-email">contact@mihan.sa</a>
  <span class="separator">•</span>
  <span>© 2025 مِهَن — جميع الحقوق محفوظة</span>
</footer>

<script>
const params = new URLSearchParams(window.location.search);
const id = Number(params.get('id'));

// جلب قائمة الخدمات المحفوظة من services.html
let services = [];
try { services = JSON.parse(localStorage.getItem('services') || '[]'); } catch(e){ services = []; }

const service = services.find(x => Number(x.id) === id);
const box = document.getElementById('details');

// تقييمات + تعليقات مبدئية (عدّليها كما تحبين)
const seed = {
  2: { rating: 4.6, reviews: [
        {name:'سارة', text:'خدمة ممتازة وسريعة 👌'},
        {name:'محمد', text:'الفني محترف والتعامل راقٍ.'},
      ]},
  3: { rating: 4.3, reviews: [
        {name:'مجد', text:'حلّ المشكلة بسرعة. شكراً!'},
      ]},
  5: { rating: 4.2, reviews: [
        {name:'نورة', text:'نظيفين وشغلهم مرتب قبل المناسبة.'},
      ]},
  7: { rating: 4.1, reviews: [
        {name:'أبو فيصل', text:'سعر مناسب وجودة جيدة.'},
      ]},
};

// تحويل HH:MM:SS -> HH:MM إن وُجدت
function fmtTime(t){
  if(!t) return '-';
  const parts = t.toString().split(':');
  return parts.length >= 2 ? `${parts[0]}:${parts[1]}` : t;
}

function starsHTML(val){
  if(!val) return '<span class="muted">لا يوجد تقييم بعد</span>';
  const full = Math.floor(val);
  const half = (val - full) >= 0.5 ? 1 : 0;
  const empty = 5 - full - half;
  return `<span class="stars">${
    '★'.repeat(full) + (half ? '½' : '') + '☆'.repeat(empty)
  }</span> <strong>${val.toFixed(1)}</strong>`;
}


 
  if(!id || !service){
    box.innerHTML = "<h3>لم يتم العثور على تفاصيل هذه الخدمة.</h3>";
  } else {
    const extra   = seed[service.id] || {};
    const rating  = extra.rating || null;
    const reviews = extra.reviews || [];

    box.innerHTML = `
      <h2>${service.title}</h2>
      <p class="desc">${service.desc || '-'}</p>

      <div class="info">
        <span>⏱️ ${fmtTime(service.time)}</span>
        <span>💰 ${service.price} ر.س</span>
      </div>

      <div class="rating">
        ${starsHTML(rating)}
      </div>

      <p class="muted" style="margin-top:6px">التعليقات</p>
      <ul class="reviews">
        ${reviews.length
          ? reviews.map(r=>`<li><strong>${r.name}</strong> ${r.text}</li>`).join('')
          : '<li class="muted" style="text-align:center">لا توجد تعليقات بعد</li>'}
      </ul>

      <button id="addToCartBtn" class="btn">طلب الخدمة</button>
    `;

    // ✅ إصلاح الإضافة للسلة + التحويل مباشرة
    document.getElementById('addToCartBtn').addEventListener('click', () => {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');

      // هل العنصر موجود مسبقًا؟
      const exists = cart.find(item => Number(item.id) === Number(service.id));

      if (!exists) {
        // حاول نستخرج إيموجي من العنوان (أول حرف إن كان رمز)
        const titleFirst = (service.title || '').trim()[0] || '';
        const emojiGuess = /[\p{Emoji}\u2600-\u27BF]/u.test(titleFirst) ? titleFirst : '🧰';

        cart.push({
          id:        service.id,
          title:     service.title,
          price:     service.price,
          time:      service.time || 'غير محدد',
          emoji:     emojiGuess,
          description: service.desc || '',
          qty:       1
        });
        localStorage.setItem('cart', JSON.stringify(cart));
      }

      // التحويل مباشرة لصفحة السلة
      window.location.href = 'chart.html';
    });
  }
</script>

</body>
</html>

